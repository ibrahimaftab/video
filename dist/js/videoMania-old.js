const supportedVideoFormat=["mp4","webm","ogg"];let videoManiaHlsjs=null,videoManiaDashjs=null;const hlsDashjs=(t,n)=>({m3u8:{url:"https://cdn.jsdelivr.net/npm/hls.js@1",init:async()=>{var e;videoManiaHlsjs||(e=await import("./hls.js"),videoManiaHlsjs=e.default),videoManiaHlsjs(t,n)}},mpd:{url:"https://cdnjs.cloudflare.com/ajax/libs/dashjs/4.5.0/dash.all.min.js",init:async()=>{var e;videoManiaDashjs||(e=await import("./dash.js"),videoManiaDashjs=e.default),videoManiaDashjs(t,n)}}});async function videoMania(e){(await import("./functions/initiate.js")).default(e);const{playPauseIcon:t,fullscreenIcon:n,audioIcon:i,muteIcon:a,settingIcon:r}=await import("./icons.js"),{addLoader:o,removeLoader:s}=await import("./loader.js");var{playbackHtml:d,qualityBtn:F,qualityList:P}=await import("./defaultsHtml.js");const{forwardRewindIcon:c,initialObj:R,videoDurationFormat:l,setDropdownSettingHeight:$,volumeIcon:O,replayIconBtn:V}=await import("./utils.js"),u={...R,...e},m=(document.head.insertAdjacentHTML("beforeend",'<style id="videomania-style"></style>'),document.createElement("player")),p=document.createElement("video"),v=document.createElement("overlayplay"),y=document.createElement("playerbar"),L=document.createElement("play"),w=document.createElement("timeline"),h=document.createElement("end"),E=document.createElement("toggle-screen"),f=document.createElement("timeline-progressbar"),b=document.createElement("timeline-buffer"),g=document.createElement("timeline-progress"),k=document.createElement("audio-icon");e=document.createElement("span");let q=u.toggleSubtitle;b.style.width="0px",g.style.width="0px";const x=document.createElement("dropdown"),j=(x.innerHTML=d,x.querySelector("#playback-btn").addEventListener("click",function(){x.classList.add("show-playback"),x.classList.add("dropdown-active")}),x.querySelectorAll(".dropdown-back").forEach(e=>{e.addEventListener("click",function(){x.classList.remove("dropdown-active"),setTimeout(()=>{x.classList=[]},150)})}),x.querySelectorAll("#playback-list button:not(.dropdown-back)").forEach(t=>{t.addEventListener("click",function(){var e="Normal"===t.textContent?p.defaultPlaybackRate:Number(t.textContent);p.playbackRate=e,x.querySelector("#playback-list .dropdown-back").dispatchEvent(new Event("click"))})}),e.role="button",e.tabIndex="4",e.innerHTML=u.muted?a:i,k.append(e),k.addEventListener("click",function(){p.muted=!p.muted}),document.createElement("setting"));d=document.createElement("span");d.role="button",d.tabIndex="5",d.innerHTML=r,j.append(x),j.append(d),d.addEventListener("click",()=>{j.classList.toggle("show-dropdown"),x.classList=[]});let T=!u.autoplay,S=!1,M=!1,H;async function I(){var e=g.cloneNode(),t=(e.classList.add("hover-timeline"),f.append(b,g,e),w.append(f,h),y.append(L,w,k,j),"pictureInPictureEnabled"in document&&(e=document.createElement("miniplayer-btn"),t=(await import("./icons.js"))["picInPicIcon"],e.innerHTML=t,e.addEventListener("click",function(){try{p.requestPictureInPicture()}catch(e){console.log(e)}}),y.append(e)),y.append(E),m.append(p,v,y),document.querySelector(u.selector));t.append(m),o(t),$(u.selector)}function C(){H&&clearTimeout(H),m.classList.add("active"),H=setTimeout(()=>{m.classList.remove("active")},5e3)}if(m.classList.add("videoMania"),m.id=u.id,m.style=`width: ${u.width}px; height: ${u.height}px; margin: auto`,m.dataset.toggle=u.autoplay?"played":"paused",m.addEventListener("mouseenter",C),m.addEventListener("mousemove",C),m.addEventListener("keydown",function(e){switch(e.key){case"f":document.fullscreen?document.exitFullscreen():m.requestFullscreen();break;case"ArrowLeft":p.currentTime=p.currentTime-10,c(m,"ArrowLeft");break;case"ArrowRight":p.currentTime=p.currentTime+10,c(m,"ArrowRight");break;case"m":p.muted=!p.muted,O(m,"m")}}),m.addEventListener("mouseleave",function(){var e=m.querySelector(".show-dropdown");e&&(e.querySelector("dropdown").classList=[],e.classList.remove("show-dropdown"))}),E.addEventListener("click",e=>{e.preventDefault(),(S=!S)?m.requestFullscreen():document.exitFullscreen()}),E.addEventListener("keydown",e=>{e.preventDefault();["Enter"," "].includes(e.key)&&E.dispatchEvent(new Event("click"))}),L.addEventListener("click",e=>{e.preventDefault(),(T=!T)?p.pause():p.play(),m.dataset.toggle=T?"paused":"played"}),L.addEventListener("keydown",e=>{e.preventDefault();["Enter"," "].includes(e.key)&&L.dispatchEvent(new Event("click"))}),v.role="button",v.tabIndex="0",v.addEventListener("click",e=>{m.querySelector(".show-dropdown")?.classList.remove("show-dropdown"),L.dispatchEvent(new Event("click"))}),v.addEventListener("keydown",e=>{e.preventDefault();["Enter"," "].includes(e.key)&&L.dispatchEvent(new Event("click"))}),p.id="videoMania-video-"+u.id,p.width=u.width,p.height=u.height,p.autoplay=u.autoplay,p.muted=u.muted,p.loop=u.loop,p.addEventListener("play",function(){var e;v.classList.add("active"),"0:00"==h.textContent&&(e=l(p,M),h.textContent=e),setTimeout(()=>{v.classList.remove("active")},200),s(document.querySelector(u.selector))}),p.addEventListener("loadedVideoData",function(){m.dataset.toggle=p.autoplay&&p.played?"played":"paused"}),p.addEventListener("loadeddata",function(){var e=l(p,M);h.textContent=e}),p.addEventListener("timeupdate",function(){var e=M;g.style.width=p.currentTime/p.duration*100+"%",b.style.width=(p.buffered?.end(p.buffered.length-1)??0)/p.duration*100+"%",currentUrl=p.src,M&&(e=l(p,e),h.textContent=e)}),p.addEventListener("pause",function(){v.classList.add("active"),setTimeout(()=>{v.classList.remove("active")},200)}),p.addEventListener("seeking",function(){o(document.querySelector(u.selector))}),p.addEventListener("seeked",function(){s(document.querySelector(u.selector))}),p.addEventListener("volumechange",e=>{var t=document.querySelector(u.selector+" audio-icon span");t&&(t.innerHTML=p.muted?a:i)}),p.addEventListener("ended",function(){m.dataset.toggle="paused",V(m)}),p.onerror=()=>{console.error(`Error ${p.error.code}; details: `+p.error.message)},p.addEventListener("error",function(){console.log("error")}),f.addEventListener("mousemove",e=>{var t=document.querySelector(u.selector+" .hover-timeline"),e=e.layerX/e.target.clientWidth*100+"%";t.style.width=e}),f.addEventListener("mouseleave",e=>{document.querySelector(u.selector+" .hover-timeline").style.width="0px"}),f.addEventListener("click",e=>{var t=f.getBoundingClientRect().x,n=f.getBoundingClientRect().width,e=e.clientX-t;p.currentTime=e/n*p.duration,g.style.width=p.currentTime/p.duration*f.clientWidth+"px"}),v.innerHTML=t,L.role="button",L.tabIndex="1",L.innerHTML=t,h.role="button",h.tabIndex="3",h.textContent="0:00",h.addEventListener("click",function(){M=!M;var e=l(p,M);h.textContent=e}),E.role="button",E.tabIndex="6",E.innerHTML=n,f.role="button",f.tabIndex="2",u.subtitles.length){e=document.createElement("button"),d=(e.id="subtitle-btn",x.querySelector("#setting-dropdown").append(e),await import("./defaultsHtml.js"))["subtitleBtn"];e.innerHTML=d;const D=(await import("./utils.js"))["onCueChange"],B=(u.subtitles.forEach(e=>{var t=document.createElement("track");t.src=e.url,t.srclang=e.lang,t.kind="captions",t.default=!0,p.append(t),p.addEventListener("timeupdate",e=>D(e,q))}),e.querySelector("span"));B.textContent=q?"On":"Off",e.addEventListener("click",function(){q=!q,B.textContent=q?"On":"Off"})}if(u.url&&u.selector){d=u.url.split(".");if(1<d.length){var d=d[d.length-1].toLowerCase(),A=hlsDashjs(u.selector,u.url);if(A[d]){const e=A[d];document.querySelector("script#videomania-"+d)?e.init():(A=(await import("./utils.js"))["addScript"],A(e.url,d).onload=e.init)}else supportedVideoFormat.includes(d)?(e=(await import("./utils.js"))["checkVideoBuffer"],e(p,u.selector),u.qualities.length?(x.querySelector("#setting-dropdown").insertAdjacentHTML("beforeend",F),p.src=u.url,x.insertAdjacentHTML("beforeend",P),u.qualities.forEach(e=>{x.querySelector("#quality-list").insertAdjacentHTML("beforeend",`<button>${e.size}</button>`)}),x.querySelector("#quality-list").insertAdjacentHTML("beforeend",'<button class="active">Auto</button>')):p.src=u.url,I(),document.querySelector(u.selector+" #quality-list")&&(A=(await import("./utils.js"))["qualityListHeight"],A(u.selector)),document.querySelector(u.selector+" #quality-btn")?.addEventListener("click",()=>{x.classList.add("show-quality"),x.classList.add("dropdown-active")}),document.querySelector(u.selector+" #quality-list .dropdown-back")?.addEventListener("click",()=>{x.classList.remove("dropdown-active"),setTimeout(()=>{x.classList=[]},150)}),document.querySelectorAll(u.selector+" #quality-list button:not(.dropdown-back)").forEach(function(a){a.addEventListener("click",e=>{var t,n,e=e.target;if(!a.classList.contains("active")){const i=a.textContent;"Auto"!=i?(n=u.qualities.find(e=>e.size==i)?.src)&&(t=p["currentTime"],p.src=n,p.currentTime=t):(n=p["currentTime"],p.src=u.url,p.currentTime=n),document.querySelector(u.selector+" #quality-list button.active").classList.remove("active"),e.classList.add("active")}})})):document.querySelector(u.selector).insertAdjacentHTML("beforeend",`<div class="player-error" style="width: ${u.width}px; height: ${u.height}px"><?xml version="1.0" ?><svg id="Layer_1" style="enable-background:new 0 0 612 792;" version="1.1" viewBox="0 0 612 792" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><polygon class="st0" points="382.2,396.4 560.8,217.8 484,141 305.4,319.6 126.8,141 50,217.8 228.6,396.4 50,575 126.8,651.8    305.4,473.2 484,651.8 560.8,575 382.2,396.4  "/></g></svg>Please add a valid video url</div>`)}document.querySelector(u.selector).addEventListener("videoManiaInit",I)}}