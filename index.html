<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="player.css" />
  </head>
  <body
    style="
      display: flex;
      flex-wrap: wrap;
      margin: 0;
      justify-content: center;
      gap: 2em;
      height: 100vh;
      align-items: center;
      background-color: #000;
    "
  >
    <div id="player2"></div>
    <div id="player"></div>

    <script>
      const playPauseIcon =
        '<svg class="play-icon" style="enable-background: new 0 0 512 512" version="1.1" viewBox="0 0 512 512" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" > <path d="M405.2,232.9L126.8,67.2c-3.4-2-6.9-3.2-10.9-3.2c-10.9,0-19.8,9-19.8,20H96v344h0.1c0,11,8.9,20,19.8,20  c4.1,0,7.5-1.4,11.2-3.4l278.1-165.5c6.6-5.5,10.8-13.8,10.8-23.1C416,246.7,411.8,238.5,405.2,232.9z" /> </svg> <svg class="pause-icon" viewBox="0 0 32 32" width="32" xmlns="http://www.w3.org/2000/svg" > <path d="M12,6H10A2,2,0,0,0,8,8V24a2,2,0,0,0,2,2h2a2,2,0,0,0,2-2V8a2,2,0,0,0-2-2Z" /> <path d="M22,6H20a2,2,0,0,0-2,2V24a2,2,0,0,0,2,2h2a2,2,0,0,0,2-2V8a2,2,0,0,0-2-2Z" /> <rect /> </svg>';
      const fullscreenIcon = `<svg fill="none" viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg" > <path clip-rule="evenodd" d="M2 2.5C2 2.22386 2.22386 2 2.5 2H5.5C5.77614 2 6 2.22386 6 2.5C6 2.77614 5.77614 3 5.5 3H3V5.5C3 5.77614 2.77614 6 2.5 6C2.22386 6 2 5.77614 2 5.5V2.5ZM9 2.5C9 2.22386 9.22386 2 9.5 2H12.5C12.7761 2 13 2.22386 13 2.5V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3H9.5C9.22386 3 9 2.77614 9 2.5ZM2.5 9C2.77614 9 3 9.22386 3 9.5V12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H2.5C2.22386 13 2 12.7761 2 12.5V9.5C2 9.22386 2.22386 9 2.5 9ZM12.5 9C12.7761 9 13 9.22386 13 9.5V12.5C13 12.7761 12.7761 13 12.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H12V9.5C12 9.22386 12.2239 9 12.5 9Z" fill="currentColor" fill-rule="evenodd" /> </svg>`;
      const liveIcon = `<svg fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5.98959 4.92865C6.28249 5.22155 6.28249 5.69642 5.98959 5.98931C2.67014 9.30877 2.67014 14.6907 5.98959 18.0101C6.28249 18.303 6.28249 18.7779 5.98959 19.0708C5.6967 19.3637 5.22183 19.3637 4.92893 19.0708C1.02369 15.1655 1.02369 8.8339 4.92893 4.92865C5.22183 4.63576 5.6967 4.63576 5.98959 4.92865ZM19.0711 4.92865C22.9763 8.8339 22.9763 15.1655 19.0711 19.0708C18.7782 19.3637 18.3033 19.3637 18.0104 19.0708C17.7175 18.7779 17.7175 18.303 18.0104 18.0101C21.3299 14.6907 21.3299 9.30877 18.0104 5.98931C17.7175 5.69642 17.7175 5.22155 18.0104 4.92865C18.3033 4.63576 18.7782 4.63576 19.0711 4.92865ZM8.81802 7.75708C9.11091 8.04997 9.11091 8.52485 8.81802 8.81774C7.06066 10.5751 7.06066 13.4243 8.81802 15.1817C9.11091 15.4746 9.11091 15.9495 8.81802 16.2424C8.52513 16.5353 8.05025 16.5353 7.75736 16.2424C5.41421 13.8992 5.41421 10.1002 7.75736 7.75708C8.05025 7.46419 8.52513 7.46419 8.81802 7.75708ZM16.2426 7.75708C18.5858 10.1002 18.5858 13.8992 16.2426 16.2424C15.9497 16.5353 15.4749 16.5353 15.182 16.2424C14.8891 15.9495 14.8891 15.4746 15.182 15.1817C16.9393 13.4243 16.9393 10.5751 15.182 8.81774C14.8891 8.52485 14.8891 8.04997 15.182 7.75708C15.4749 7.46419 15.9497 7.46419 16.2426 7.75708ZM12 10.4997C12.8284 10.4997 13.5 11.1713 13.5 11.9997C13.5 12.8281 12.8284 13.4997 12 13.4997C11.1716 13.4997 10.5 12.8281 10.5 11.9997C10.5 11.1713 11.1716 10.4997 12 10.4997Z" fill="curre"ntColor/></svg>`;
      const loaderAnimatedIcon = `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"> <circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138"> <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"/> </circle> <!-- [ldio] generated by https://loading.io/ --></svg>`;
      const rewindIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M11.5 280.6l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2zm256 0l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2z"/></svg>`;
      const forwardIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"/></svg>`;
      const audioIcon = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M232,416a23.88,23.88,0,0,1-14.2-4.68,8.27,8.27,0,0,1-.66-.51L125.76,336H56a24,24,0,0,1-24-24V200a24,24,0,0,1,24-24h69.75l91.37-74.81a8.27,8.27,0,0,1,.66-.51A24,24,0,0,1,256,120V392a24,24,0,0,1-24,24ZM125.82,336Zm-.27-159.86Z"/><path d="M320,336a16,16,0,0,1-14.29-23.19c9.49-18.87,14.3-38,14.3-56.81,0-19.38-4.66-37.94-14.25-56.73a16,16,0,0,1,28.5-14.54C346.19,208.12,352,231.44,352,256c0,23.86-6,47.81-17.7,71.19A16,16,0,0,1,320,336Z"/><path d="M368,384a16,16,0,0,1-13.86-24C373.05,327.09,384,299.51,384,256c0-44.17-10.93-71.56-29.82-103.94a16,16,0,0,1,27.64-16.12C402.92,172.11,416,204.81,416,256c0,50.43-13.06,83.29-34.13,120A16,16,0,0,1,368,384Z"/><path d="M416,432a16,16,0,0,1-13.39-24.74C429.85,365.47,448,323.76,448,256c0-66.5-18.18-108.62-45.49-151.39a16,16,0,1,1,27-17.22C459.81,134.89,480,181.74,480,256c0,64.75-14.66,113.63-50.6,168.74A16,16,0,0,1,416,432Z"/></svg>`;
      const muteIcon = `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><line style="fill:none;stroke:currentColor;stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" x1="416" x2="64" y1="432" y2="80"/><path d="M243.33,98.86a23.89,23.89,0,0,0-25.55,1.82l-.66.51L188.6,124.54a8,8,0,0,0-.59,11.85l54.33,54.33A8,8,0,0,0,256,185.06V120.57A24.51,24.51,0,0,0,243.33,98.86Z"/><path d="M251.33,335.29,96.69,180.69A16,16,0,0,0,85.38,176H56a24,24,0,0,0-24,24V312a24,24,0,0,0,24,24h69.76l92,75.31A23.9,23.9,0,0,0,243.63,413,24.51,24.51,0,0,0,256,391.45V346.59A16,16,0,0,0,251.33,335.29Z"/><path d="M352,256c0-24.56-5.81-47.87-17.75-71.27a16,16,0,1,0-28.5,14.55C315.34,218.06,320,236.62,320,256q0,4-.31,8.13a8,8,0,0,0,2.32,6.25l14.36,14.36a8,8,0,0,0,13.55-4.31A146,146,0,0,0,352,256Z"/><path d="M416,256c0-51.18-13.08-83.89-34.18-120.06a16,16,0,0,0-27.64,16.12C373.07,184.44,384,211.83,384,256c0,23.83-3.29,42.88-9.37,60.65a8,8,0,0,0,1.9,8.26L389,337.4a8,8,0,0,0,13.13-2.79C411,311.76,416,287.26,416,256Z"/><path d="M480,256c0-74.25-20.19-121.11-50.51-168.61a16,16,0,1,0-27,17.22C429.82,147.38,448,189.5,448,256c0,46.19-8.43,80.27-22.43,110.53a8,8,0,0,0,1.59,9l11.92,11.92A8,8,0,0,0,452,385.29C471.6,344.9,480,305,480,256Z"/></svg>`;
      const settingIcon = `<svg style="enable-background:new 0 0 24 24;" version="1.1" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M22.2,14.4L21,13.7c-1.3-0.8-1.3-2.7,0-3.5l1.2-0.7c1-0.6,1.3-1.8,0.7-2.7l-1-1.7c-0.6-1-1.8-1.3-2.7-0.7   L18,5.1c-1.3,0.8-3-0.2-3-1.7V2c0-1.1-0.9-2-2-2h-2C9.9,0,9,0.9,9,2v1.3c0,1.5-1.7,2.5-3,1.7L4.8,4.4c-1-0.6-2.2-0.2-2.7,0.7   l-1,1.7C0.6,7.8,0.9,9,1.8,9.6L3,10.3C4.3,11,4.3,13,3,13.7l-1.2,0.7c-1,0.6-1.3,1.8-0.7,2.7l1,1.7c0.6,1,1.8,1.3,2.7,0.7L6,18.9   c1.3-0.8,3,0.2,3,1.7V22c0,1.1,0.9,2,2,2h2c1.1,0,2-0.9,2-2v-1.3c0-1.5,1.7-2.5,3-1.7l1.2,0.7c1,0.6,2.2,0.2,2.7-0.7l1-1.7   C23.4,16.2,23.1,15,22.2,14.4z M12,16c-2.2,0-4-1.8-4-4c0-2.2,1.8-4,4-4s4,1.8,4,4C16,14.2,14.2,16,12,16z" id="settings"/></svg>`;
      const playbackHtml = `<nav id="setting-dropdown"><button id="playback-btn"><svg enable-background="new 0 0 64 64" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.371,31.879c0,2.19,1.777,3.966,3.966,3.966c1.538,0,2.856-0.884,3.514-2.163l0.011,0.01l7.24-13.062l-12.71,7.794   l0.012,0.012C29.197,29.117,28.371,30.395,28.371,31.879z"/><path d="M48.315,12.981C44.251,9.429,39,7.161,33,6.822v6.027c5,0.318,7.946,1.906,10.904,4.384L48.315,12.981z"/><path d="M51.146,30h6.02c-0.404-6-2.751-10.93-6.395-14.97l-4.259,4.233C49.078,22.203,50.766,26,51.146,30z"/><path d="M51.174,33c-0.637,10-8.922,17.931-19.042,17.931c-10.535,0-19.421-8.544-19.421-19.078C12.711,21.825,21,13.62,30,12.85   V6.823C17,7.602,6.711,18.54,6.711,31.879c0,13.843,11.42,25.052,25.263,25.052C45.406,56.931,56.564,46,57.205,33H51.174z"/></svg> Playback Speed </button><button id="subtitle-btn"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><rect height="2" width="6" x="19" y="17"/><rect height="2" width="6" x="11" y="17"/><rect height="2" width="3" x="6" y="17"/><rect height="2" width="4" x="22" y="13"/><rect height="2" width="7" x="13" y="13"/><rect height="2" width="5" x="6" y="13"/><path d="M17.7358,30,16,29l4-7h6a1.9966,1.9966,0,0,0,2-2V8a1.9966,1.9966,0,0,0-2-2H6A1.9966,1.9966,0,0,0,4,8V20a1.9966,1.9966,0,0,0,2,2h9v2H6a3.9993,3.9993,0,0,1-4-4V8A3.9988,3.9988,0,0,1,6,4H26a3.9988,3.9988,0,0,1,4,4V20a3.9993,3.9993,0,0,1-4,4H21.1646Z"/><rect fill="none" height="32" width="32"/></svg> Subtitle </button></nav><nav id="playback-list"><button class="dropdown-back">Playback Speed</button><button>0.25</button><button>0.5</button><button>0.75</button><button>Normal</button><button>1.25</button><button>1.5</button><button>1.75</button><button>2</button></nav>`;
      const qualityBtn = `<button id="quality-btn"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48h-48z" fill="none"/><path d="M6 34v4h12v-4h-12zm0-24v4h20v-4h-20zm20 32v-4h16v-4h-16v-4h-4v12h4zm-12-24v4h-8v4h8v4h4v-12h-4zm28 8v-4h-20v4h20zm-12-8h4v-4h8v-4h-8v-4h-4v12z"/></svg> Quality </button>`;
      const qualityList = `<nav id="quality-list"><button class="dropdown-back">Quality</button></nav>`;
      const initialObj = {
        selector: null,
        width: 800,
        height: 450,
        autoplay: false,
        muted: false,
        loop: false,
        url: null,
        dashjs: null,
        hlsjs: null,
        id: null,
        qualities: [],
      };
      const videoManiaInitEvent = new Event("videoManiaInit");

      function forwardRewindIcon(player, key) {
        if (key === "ArrowLeft" || key === "ArrowRight") {
          const forwardRewind = document.createElement("forward-rewind");
          forwardRewind.innerHTML =
            key === "ArrowLeft" ? rewindIcon : forwardIcon;
          forwardRewind.id = "forward-rewind";
          player.append(forwardRewind);
          setTimeout(() => {
            player.querySelector("#forward-rewind").remove();
          }, 300);
        }
      }

      function addScript(url, id) {
        const script = document.createElement("script");
        script.src = url;
        script.id = `videomania-${id}`;
        document.body.append(script);
        return script;
      }

      function addLoader(selector) {
        if (
          !selector.querySelector("loader") &&
          !selector.querySelector("#forward-rewind")
        ) {
          const loader = document.createElement("loader");
          loader.innerHTML = loaderAnimatedIcon;
          loader.id = "videoManiaLoader";
          selector.querySelector("player").append(loader);
        }
      }

      function removeLoader(selector) {
        if (selector.querySelector("loader")) {
          selector.querySelector("#videoManiaLoader").remove();
        }
      }

      function videoManiaLive(selector) {
        const live = document.createElement("live");
        live.innerHTML = liveIcon;
        live.append("Live");
        selector.querySelector("timeline").remove();
        selector.querySelector("play").after(live);
      }

      function videoDurationFormat(video, subtract = false) {
        const date = new Date(null);
        const seconds = subtract
          ? video.duration - video.currentTime
          : video.duration;
        date.setSeconds(seconds);
        const formatDuration = date.toISOString().substr(11, 8);
        if (formatDuration.split(":")[0] != "00") {
          return (subtract ? "-" : "") + formatDuration;
        }
        const splitHMS = formatDuration.split(":");
        return `${subtract ? "-" : ""}${splitHMS[1]}:${splitHMS[2]}`;
      }

      function videoMania(obj = initialObj) {
        const settings = {
          ...initialObj,
          ...obj,
        };
        document.head.insertAdjacentHTML(
          "beforeend",
          '<style id="videomania-style"></style>'
        );
        const player = document.createElement("player");
        const video = document.createElement("video");
        const width = 800;
        const height = 450;
        const overlayplay = document.createElement("overlayplay");
        const playerbar = document.createElement("playerbar");
        const play = document.createElement("play");
        const timeline = document.createElement("timeline");
        const end = document.createElement("end");
        const toggleScreen = document.createElement("toggle-screen");
        const timelineProgressbar = document.createElement(
          "timeline-progressbar"
        );
        const timelineBuffer = document.createElement("timeline-buffer");
        const timelineProgress = document.createElement("timeline-progress");
        const audioIconButton = document.createElement("audio-icon");
        const audioSpan = document.createElement("span");

        const dropdown = document.createElement("dropdown");
        dropdown.innerHTML = playbackHtml;

        dropdown
          .querySelector("#playback-btn")
          .addEventListener("click", function () {
            dropdown.classList.add("show-playback");
            dropdown.classList.add("dropdown-active");
          });

        dropdown.querySelectorAll(".dropdown-back").forEach((elm) => {
          elm.addEventListener("click", function () {
            dropdown.classList.remove("dropdown-active");
            setTimeout(() => {
              dropdown.classList = [];
            }, 150);
          });
        });

        dropdown
          .querySelectorAll("#playback-list button:not(.dropdown-back)")
          .forEach((elm) => {
            elm.addEventListener("click", function () {
              const playback =
                elm.textContent === "Normal"
                  ? video.defaultPlaybackRate
                  : Number(elm.textContent);
              video.playbackRate = playback;
              dropdown
                .querySelector("#playback-list .dropdown-back")
                .dispatchEvent(new Event("click"));
            });
          });

        audioSpan.role = "button";
        audioSpan.tabIndex = "4";
        audioSpan.innerHTML = settings.muted ? muteIcon : audioIcon;
        audioIconButton.append(audioSpan);
        audioIconButton.addEventListener("click", function () {
          video.muted = !video.muted;
        });

        const settingButton = document.createElement("setting");
        const settingButtonSpan = document.createElement("span");
        settingButtonSpan.role = "button";
        settingButtonSpan.tabIndex = "5";
        settingButtonSpan.innerHTML = settingIcon;
        settingButton.append(dropdown);
        settingButton.append(settingButtonSpan);

        settingButtonSpan.addEventListener("click", () =>
          settingButton.classList.toggle("show-dropdown")
        );

        let bufferedLength = 1;
        let paused = false;
        let fullscreen = false;
        let endSubtract = false;

        let currentUrl = settings.url;

        player.classList.add("videoMania");
        player.id = settings.id;
        player.style = `width: ${settings.width}px; height: ${settings.height}px; margin: auto`;

        player.addEventListener("keydown", function (e) {
          switch (e.key) {
            case "f":
              document.fullscreen
                ? document.exitFullscreen()
                : player.requestFullscreen();
              break;
            case "ArrowLeft":
              video.currentTime = video.currentTime - 10;
              forwardRewindIcon(player, "ArrowLeft");
              break;
            case "ArrowRight":
              video.currentTime = video.currentTime + 10;
              forwardRewindIcon(player, "ArrowRight");
              break;
          }
        });

        player.addEventListener("mouseleave", function () {
          const showDropdown = player.querySelector(".show-dropdown");
          if (showDropdown) {
            showDropdown.querySelector("dropdown").classList = [];
            showDropdown.classList.remove("show-dropdown");
          }
        });

        toggleScreen.addEventListener("click", (e) => {
          e.preventDefault();
          fullscreen = !fullscreen;
          fullscreen ? player.requestFullscreen() : document.exitFullscreen();
        });

        toggleScreen.addEventListener("keydown", (e) => {
          e.preventDefault();
          const selectedKeys = ["Enter", " "];
          selectedKeys.includes(e.key) &&
            toggleScreen.dispatchEvent(new Event("click"));
        });

        play.addEventListener("click", (e) => {
          e.preventDefault();
          paused = !paused;
          paused ? video.pause() : video.play();
          player.dataset.toggle = paused ? "paused" : "played";
        });

        play.addEventListener("keydown", (e) => {
          e.preventDefault();
          const selectedKeys = ["Enter", " "];
          selectedKeys.includes(e.key) &&
            play.dispatchEvent(new Event("click"));
        });

        overlayplay.role = "button";
        overlayplay.tabIndex = "0";

        overlayplay.addEventListener("click", (e) => {
          player
            .querySelector(".show-dropdown")
            ?.classList.remove("show-dropdown");
          play.dispatchEvent(new Event("click"));
        });

        overlayplay.addEventListener("keydown", (e) => {
          e.preventDefault();
          const selectedKeys = ["Enter", " "];
          selectedKeys.includes(e.key) &&
            play.dispatchEvent(new Event("click"));
        });

        video.id = `videoMania-video-${settings.id}`;
        video.width = settings.width;
        video.height = settings.height;
        video.autoplay = settings.autoplay;
        video.muted = settings.muted;
        video.loop = settings.loop;

        video.addEventListener("play", function () {
          overlayplay.classList.add("active");
          if (end.textContent == "0:00") {
            const formatDuration = videoDurationFormat(video, endSubtract);
            end.textContent = formatDuration;
          }
          setTimeout(() => {
            overlayplay.classList.remove("active");
          }, 200);
          removeLoader(document.querySelector(settings.selector));
        });

        video.addEventListener("loadedVideoData", function () {
          player.dataset.toggle =
            video.autoplay && video.played ? "played" : "paused";
        });

        video.addEventListener("timeupdate", function () {
          const getEndSubsctract = endSubtract;
          timelineProgress.style.transform = `scaleX(${
            video.currentTime / video.duration
          })`;
          if (currentUrl == video.src) {
            timelineBuffer.style.transform = `scaleX(${
              (video.buffered?.end(0) ?? 0) / video.duration
            })`;
            currentUrl = video.src;
          }
          if (endSubtract) {
            const formatDuration = videoDurationFormat(video, getEndSubsctract);
            end.textContent = formatDuration;
          }
        });

        video.addEventListener("pause", function () {
          overlayplay.classList.add("active");
          setTimeout(() => {
            overlayplay.classList.remove("active");
          }, 200);
        });

        video.addEventListener("seeking", function () {
          addLoader(document.querySelector(settings.selector));
        });

        video.addEventListener("seeked", function () {
          removeLoader(document.querySelector(settings.selector));
        });

        video.addEventListener("volumechange", (e) => {
          const audioIconSpan = document.querySelector(
            `${settings.selector} audio-icon span`
          );
          audioIconSpan &&
            (audioIconSpan.innerHTML = video.muted ? muteIcon : audioIcon);
        });

        timelineProgressbar.addEventListener("click", (e) => {
          const clientRectLeft = timelineProgressbar.getBoundingClientRect().x;
          const clientRectWidth =
            timelineProgressbar.getBoundingClientRect().width;
          const timelineWidth = clientRectWidth;
          const timelinePosition = e.clientX - clientRectLeft;
          video.currentTime =
            (timelinePosition / timelineWidth) * video.duration;
        });

        overlayplay.innerHTML = playPauseIcon;

        play.role = "button";
        play.tabIndex = "1";
        play.innerHTML = playPauseIcon;

        end.role = "button";
        end.tabIndex = "3";
        end.textContent = "0:00";

        end.addEventListener("click", function () {
          endSubtract = !endSubtract;
          const formatDuration = videoDurationFormat(video, endSubtract);
          end.textContent = formatDuration;
        });

        toggleScreen.role = "button";
        toggleScreen.tabIndex = "6";
        toggleScreen.innerHTML = fullscreenIcon;

        timelineProgressbar.role = "button";
        timelineProgressbar.tabIndex = "2";

        if (settings.url && settings.selector) {
          paused = !settings.autoplay && !settings.muted;

          function videoAppend() {
            timelineProgressbar.append(timelineBuffer);
            timelineProgressbar.append(timelineProgress);
            timeline.append(timelineProgressbar, end);
            playerbar.append(
              play,
              timeline,
              audioIconButton,
              settingButton,
              toggleScreen
            );
            player.append(video, overlayplay, playerbar);
            document.querySelector(settings.selector).append(player);
            addLoader(document.querySelector(settings.selector));
            const style = `dropdown{height: ${
              document.querySelector(`${settings.selector} #setting-dropdown`)
                .offsetHeight
            }px}`;
            document
              .querySelector("#videomania-style")
              .insertAdjacentHTML("beforeend", style);
          }

          function videoManiaDashjs() {
            document
              .querySelector(settings.selector)
              .dispatchEvent(videoManiaInitEvent);
            const vdo =  dashjs.MediaPlayer().create();
            const appendedSelector = document.querySelector(settings.selector);
            const appendedVideo = appendedSelector.querySelector(`video`);
            vdo.initialize(appendedVideo, settings.url, true);
            vdo.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, function (e) {
              const bitrates = vdo.getBitrateInfoListFor("video")
              console.log(e)
              if (e.streamInfo.manifestInfo.isDynamic) {
                videoManiaLive(appendedSelector);
              }
              console.log(bitrates)
            });
          }

          function videoManiaHlsjs() {
            document
              .querySelector(settings.selector)
              .dispatchEvent(videoManiaInitEvent);
            const appendedSelector = document.querySelector(settings.selector);
            const appendedVideo = appendedSelector.querySelector(
              `${settings.selector} video`
            );
            const videoSrc = settings.url;
            if (Hls.isSupported()) {
              const hls = new Hls();
              hls.loadSource(videoSrc);
              hls.attachMedia(appendedVideo);
              hls.on(Hls.Events.LEVEL_LOADED, async function (name, event) {
                if (
                  event.details.live &&
                  !appendedSelector.querySelector("live")
                ) {
                  videoManiaLive(appendedSelector);
                }
              });
            } else if (
              appendedVideo.canPlayType("application/vnd.apple.mpegurl")
            ) {
              appendedVideo.src = videoSrc;
            }
          }

          // Dynamic Adaptive Dash js
          if (settings.dashjs) {
            if (!document.querySelector("script#videomania-dashjs")) {
              const script = addScript(settings.dashjs, "dashjs");
              script.onload = videoManiaDashjs;
            } else {
              videoManiaDashjs();
            }
          }
          // HTTP Live Steam js
          else if (settings.hlsjs) {
            if (!document.querySelector("script#videomania-hlsjs")) {
              const script = addScript(settings.hlsjs, "hlsjs");
              script.onload = videoManiaHlsjs;
            } else {
              videoManiaHlsjs();
            }
          } else {
            if (settings.qualities.length) {
              dropdown
                .querySelector("#setting-dropdown")
                .insertAdjacentHTML("beforeend", qualityBtn);
              video.src = settings.url;
              dropdown.insertAdjacentHTML("beforeend", qualityList);
              settings.qualities.forEach((quality) => {
                dropdown
                  .querySelector("#quality-list")
                  .insertAdjacentHTML(
                    "beforeend",
                    `<button>${quality.size}</button>`
                  );
              });
              dropdown
                .querySelector("#quality-list")
                .insertAdjacentHTML(
                  "beforeend",
                  '<button class="active">Auto</button>'
                );
            } else {
              video.src = settings.url;
            }
            videoAppend();
            const style = `dropdown.show-quality{height: ${
              document.querySelector(`${settings.selector} #quality-list`)
                .offsetHeight
            }px}`;
            document
              .querySelector("#videomania-style")
              .insertAdjacentHTML("beforeend", style);

            document
              .querySelector(`${settings.selector} #quality-btn`)
              ?.addEventListener("click", () => {
                dropdown.classList.add("show-quality");
                dropdown.classList.add("dropdown-active");
              });

            document
              .querySelector(
                `${settings.selector} #quality-list .dropdown-back`
              )
              ?.addEventListener("click", () => {
                dropdown.classList.remove("dropdown-active");
                setTimeout(() => {
                  dropdown.classList = [];
                }, 150);
              });
            document
              .querySelectorAll(
                `${settings.selector} #quality-list button:not(.dropdown-back)`
              )
              .forEach(function (elm) {
                elm.addEventListener("click", (e) => {
                  const btn = e.target;
                  if (!elm.classList.contains("active")) {
                    const size = elm.textContent;
                    if (size != "Auto") {
                      const src = settings.qualities.find(
                        (q) => q.size == size
                      )?.src;
                      if (src) {
                        const { currentTime } = video;
                        video.src = src;
                        video.currentTime = currentTime;
                      }
                    } else {
                      const { currentTime } = video;
                      video.src = settings.url;
                      video.currentTime = currentTime;
                    }
                    document
                      .querySelector(
                        `${settings.selector} #quality-list button.active`
                      )
                      .classList.remove("active");
                    btn.classList.add("active");
                  }
                });
              });
          }

          document
            .querySelector(settings.selector)
            .addEventListener("videoManiaInit", videoAppend);
        }
      }

      // videoMania({
      //   selector: "#player2",
      //   id: "player2",
      //   // url: "https://awstapmadstreaming.akamaized.net/hls/live/2095955/worldcupt/master.m3u8",
      //   // url: "http://playertest.longtailvideo.com/adaptive/wowzaid3/playlist.m3u8",
      //   url: "http://sample.vodobox.net/skate_phantom_flex_4k/skate_phantom_flex_4k.m3u8",
      //   hlsjs: "https://cdn.jsdelivr.net/npm/hls.js@1",
      //   autoplay: true,
      //   muted: true,
      //   width: 1024,
      //   height: 600,
      // });

      videoMania({
        selector: "#player",
        id: "player",
        url: "https://dash.akamaized.net/envivio/EnvivioDash3/manifest.mpd",
        // url: "https://livesim.dashif.org/livesim/chunkdur_1/ato_7/testpic4_8s/Manifest.mpd",
        dashjs:
          "https://cdnjs.cloudflare.com/ajax/libs/dashjs/4.5.0/dash.all.min.js",
        autoplay: true,
        muted: true,
        width: 1024,
        height: 480,
      });

      // videoMania({
      //   selector: "#player2",
      //   id: "player2",
      //   // url: "https://awstapmadstreaming.akamaized.net/hls/live/2095955/worldcupt/master.m3u8",
      //   // url: "http://playertest.longtailvideo.com/adaptive/wowzaid3/playlist.m3u8",
      //   // url: "http://sample.vodobox.net/skate_phantom_flex_4k/skate_phantom_flex_4k.m3u8",
      //   url: "/videos/video.mp4",
      //   autoplay: true,
      //   muted: true,
      //   width: 1024,
      //   height: 600,
      //   qualities: [
      //     {
      //       src: "/videos/video.ogg",
      //       size: 240,
      //     },
      //   ],
      // });
    </script>
  </body>
</html>
